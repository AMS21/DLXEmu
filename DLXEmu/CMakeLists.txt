cmake_minimum_required(VERSION 3.10.2)

project(DLXEmu LANGUAGES CXX)

file(
  GLOB
  DLXEMULIB_SOURCES
  "src/CodeEditor.cpp"
  "src/DebugView.cpp"
  "src/Emulator.cpp"
  "src/MemoryViewer.cpp"
  "src/RegisterViewer.cpp"
  "src/Window.cpp")
file(GLOB_RECURSE DLXEMULIB_HEADERS CONFIGURE_DEPENDS
     "${CMAKE_CURRENT_BINARY_DIR}/Generated/DLXEmu/BuildInfo.hpp" "include/DLXEmu/*.hpp")

# DLXEmuLib
add_library("DLXEmuLib" STATIC ${DLXEMULIB_SOURCES} ${DLXEMULIB_HEADERS})

target_include_directories("DLXEmuLib" PUBLIC "include")

target_link_libraries("DLXEmuLib" PUBLIC DLXLib ImGui ImGuiFilebrowser)

# DLXEmu
add_executable("DLXEmu" "src/main.cpp")

target_link_libraries("DLXEmu" PRIVATE DLXEmuLib)

# Configure BuildInfo.hpp
set(CMAKE_AUTO_GENENERATED_WARNING
    "This file is automatically generated during CMake builds. DO NOT EDIT BY HAND!")
configure_file("src/BuildInfo.hpp.in"
               "${CMAKE_BINARY_DIR}/generated-includes/DLXEmu/generated/BuildInfo.hpp")

# Read and configure thirdparty licenses
set(EXTERNAL_ROOT "${CMAKE_CURRENT_SOURCE_DIR}/../external")

file(READ "${EXTERNAL_ROOT}/fmt/LICENSE.rst" FMT_LICENSE)
file(READ "${EXTERNAL_ROOT}/glad/LICENSE" GLAD_LICENSE)
file(READ "${EXTERNAL_ROOT}/glfw/LICENSE.md" GLFW_LICENSE)
file(READ "${EXTERNAL_ROOT}/imgui/LICENSE.txt" IMGUI_LICENSE)
file(READ "${EXTERNAL_ROOT}/Phi/LICENSE" PHI_LICENSE)

configure_file("src/ThirdPartyLicense.hpp.in"
               "${CMAKE_BINARY_DIR}/generated-includes/DLXEmu/generated/ThirdPartyLicense.hpp")

target_include_directories("DLXEmuLib" PUBLIC "${CMAKE_BINARY_DIR}/generated-includes")
